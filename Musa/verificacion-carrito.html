<!DOCTYPE html>
<html>
<head>
    <title>Verificaci√≥n de Unificaci√≥n del Carrito</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .pass { background: #d4edda; border-color: #c3e6cb; }
        .fail { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
    </style>
</head>
<body>
    <h1>üîç Verificaci√≥n Final del Carrito Unificado</h1>
    
    <div id="tests"></div>
    
    <button onclick="runTests()">üß™ Ejecutar Pruebas</button>
    <button onclick="clearCart()">üóëÔ∏è Limpiar Carrito</button>
    <button onclick="addTestProduct()">‚ûï Agregar Producto de Prueba</button>
    
    <script>
        function runTests() {
            const testsDiv = document.getElementById('tests');
            let results = '';
            
            // Test 1: Verificar que solo existe 'carrito'
            const carritoData = localStorage.getItem('carrito');
            const cartData = localStorage.getItem('cart');
            
            results += `<div class="test ${cartData ? 'fail' : 'pass'}">
                <strong>Test 1: Solo 'carrito' existe</strong><br>
                'carrito': ${carritoData ? '‚úÖ Existe' : '‚ùå No existe'}<br>
                'cart': ${cartData ? '‚ùå Existe (PROBLEMA)' : '‚úÖ No existe'}
            </div>`;
            
            // Test 2: Estructura del carrito
            if (carritoData) {
                try {
                    const carrito = JSON.parse(carritoData);
                    const isArray = Array.isArray(carrito);
                    const hasCorrectStructure = carrito.length === 0 || 
                        carrito.every(item => 
                            item.hasOwnProperty('precio') && 
                            item.hasOwnProperty('cantidad') && 
                            item.hasOwnProperty('nombre') && 
                            item.hasOwnProperty('talla')
                        );
                    
                    results += `<div class="test ${isArray && hasCorrectStructure ? 'pass' : 'fail'}">
                        <strong>Test 2: Estructura correcta</strong><br>
                        Es array: ${isArray ? '‚úÖ' : '‚ùå'}<br>
                        Estructura correcta: ${hasCorrectStructure ? '‚úÖ' : '‚ùå'}<br>
                        Productos en carrito: ${carrito.length}
                    </div>`;
                } catch (e) {
                    results += `<div class="test fail">
                        <strong>Test 2: Error parseando carrito</strong><br>
                        ${e.message}
                    </div>`;
                }
            }
            
            // Test 3: Verificar localStorage completo
            const allKeys = Object.keys(localStorage);
            const cartKeys = allKeys.filter(key => key.includes('cart') || key.includes('carrito'));
            
            results += `<div class="test info">
                <strong>Test 3: Todas las claves relacionadas con carrito</strong><br>
                Claves encontradas: ${cartKeys.join(', ') || 'Ninguna'}
            </div>`;
            
            testsDiv.innerHTML = results;
        }
        
        function clearCart() {
            localStorage.removeItem('carrito');
            localStorage.removeItem('cart');
            alert('üóëÔ∏è Carrito limpiado');
            runTests();
        }
        
        function addTestProduct() {
            let carrito = JSON.parse(localStorage.getItem('carrito') || '[]');
            carrito.push({
                nombre: 'Producto de Prueba',
                precio: 50000,
                cantidad: 1,
                talla: 'M',
                imagen: 'test.jpg'
            });
            localStorage.setItem('carrito', JSON.stringify(carrito));
            alert('‚ûï Producto agregado al carrito');
            runTests();
        }
        
        // Ejecutar pruebas al cargar
        runTests();
    </script>
</body>
</html>
