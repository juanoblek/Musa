<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test MercadoPago CardForm</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://sdk.mercadopago.com/js/v2"></script>
</head>
<body class="bg-light">

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Test MercadoPago CardForm</h5>
                </div>
                <div class="card-body">
                    <form id="form-checkout">
                        <div class="mb-3">
                            <label class="form-label">N√∫mero de tarjeta</label>
                            <div id="form-checkout__cardNumber" class="form-control-mp"></div>
                        </div>
                        
                        <div class="row">
                            <div class="col-8">
                                <label class="form-label">MM/AA</label>
                                <div id="form-checkout__expirationDate" class="form-control-mp"></div>
                            </div>
                            <div class="col-4">
                                <label class="form-label">CVC</label>
                                <div id="form-checkout__securityCode" class="form-control-mp"></div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Nombre del titular</label>
                            <input type="text" id="form-checkout__cardholderName" class="form-control" placeholder="Como aparece en la tarjeta">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" id="form-checkout__cardholderEmail" class="form-control" placeholder="correo@ejemplo.com" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Cuotas</label>
                            <select id="form-checkout__installments" class="form-select">
                                <option value="1">1 cuota</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">Procesar Pago de Prueba</button>
                    </form>
                    
                    <div id="status" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.form-control-mp {
    min-height: 45px;
    border: 1px solid #ced4da;
    border-radius: 0.375rem;
    background-color: #fff;
    padding: 0;
}

.form-control-mp iframe {
    width: 100% !important;
    height: 45px !important;
    border: none !important;
    border-radius: 0.375rem;
}

.form-control-mp:focus-within {
    border-color: #86b7fe;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Iniciando test de MercadoPago...');
    
    const status = document.getElementById('status');
    
    // Verificar SDK
    if (typeof MercadoPago === 'undefined') {
        status.innerHTML = '<div class="alert alert-danger">‚ùå SDK de MercadoPago no cargado</div>';
        return;
    }
    
    status.innerHTML = '<div class="alert alert-info">‚úÖ SDK de MercadoPago cargado</div>';
    
    try {
        // Inicializar MercadoPago
        const mp = new MercadoPago('TEST-70da85e6-8bcb-4f2c-9c62-d8532ae88a4a', {
            locale: 'es-CO'
        });
        
        console.log('‚úÖ MercadoPago instancia creada');
        
        // Crear CardForm
        const cardForm = mp.cardForm({
            amount: '100',
            iframe: true,
            form: {
                id: 'form-checkout',
                cardNumber: {
                    id: 'form-checkout__cardNumber',
                    placeholder: '1234 1234 1234 1234'
                },
                expirationDate: {
                    id: 'form-checkout__expirationDate',
                    placeholder: 'MM/AA'
                },
                securityCode: {
                    id: 'form-checkout__securityCode',
                    placeholder: '123'
                },
                cardholderName: {
                    id: 'form-checkout__cardholderName',
                    placeholder: 'Nombre del titular'
                },
                cardholderEmail: {
                    id: 'form-checkout__cardholderEmail',
                    placeholder: 'correo@ejemplo.com'
                },
                installments: {
                    id: 'form-checkout__installments'
                }
            },
            callbacks: {
                onFormMounted: (error) => {
                    if (error) {
                        console.error('‚ùå Error montando CardForm:', error);
                        status.innerHTML = '<div class="alert alert-danger">‚ùå Error: ' + error.message + '</div>';
                    } else {
                        console.log('‚úÖ CardForm montado correctamente');
                        status.innerHTML = '<div class="alert alert-success">‚úÖ CardForm montado correctamente</div>';
                    }
                },
                onSubmit: (event) => {
                    event.preventDefault();
                    status.innerHTML = '<div class="alert alert-primary">üöÄ Formulario enviado (test)</div>';
                    console.log('üöÄ Formulario enviado');
                }
            }
        });
        
    } catch (error) {
        console.error('‚ùå Error:', error);
        status.innerHTML = '<div class="alert alert-danger">‚ùå Error: ' + error.message + '</div>';
    }
});
</script>

</body>
</html>
