<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Detector Inteligente de Media</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        .test-result {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
        }
        .media-test {
            max-width: 200px;
            max-height: 150px;
            object-fit: cover;
            border-radius: 8px;
        }
        .test-success {
            border-color: #28a745;
            background-color: #d4edda;
        }
        .test-error {
            border-color: #dc3545;
            background-color: #f8d7da;
        }
        .test-warning {
            border-color: #ffc107;
            background-color: #fff3cd;
        }
    </style>
</head>
<body>
    <div class="container test-container">
        <h1 class="text-center mb-4">üß† Test - Detector Inteligente de Media</h1>
        
        <div class="row">
            <div class="col-md-12">
                <h3>üìã Tests Autom√°ticos</h3>
                <div id="automaticTests"></div>
                
                <h3 class="mt-4">üß™ Test Manual</h3>
                <div class="mb-3">
                    <label for="mediaUrl" class="form-label">URL del archivo (imagen o video):</label>
                    <input type="text" class="form-control" id="mediaUrl" placeholder="Ingresa una URL...">
                </div>
                <button class="btn btn-primary" onclick="testManualUrl()">üîç Analizar</button>
                
                <div id="manualTestResult" class="mt-3"></div>
            </div>
        </div>
    </div>

    <script src="js/detector-inteligente-media.js"></script>
    
    <script>
        // Tests autom√°ticos
        async function runAutomaticTests() {
            const tests = [
                // Tests de im√°genes
                {
                    name: "Imagen JPG v√°lida",
                    url: "images/placeholder.jpg",
                    expected: "image"
                },
                {
                    name: "Imagen PNG",
                    url: "test.png",
                    expected: "image"
                },
                {
                    name: "Imagen GIF",
                    url: "test.gif",
                    expected: "image"
                },
                {
                    name: "Imagen WebP",
                    url: "test.webp",
                    expected: "image"
                },
                
                // Tests de videos
                {
                    name: "Video MP4",
                    url: "test.mp4",
                    expected: "video"
                },
                {
                    name: "Video MOV",
                    url: "test.mov",
                    expected: "video"
                },
                {
                    name: "Video AVI",
                    url: "test.avi",
                    expected: "video"
                },
                {
                    name: "Video WebM",
                    url: "test.webm",
                    expected: "video"
                },
                
                // Tests de casos especiales
                {
                    name: "URL sin extensi√≥n",
                    url: "noextension",
                    expected: "image"
                },
                {
                    name: "URL vac√≠a",
                    url: "",
                    expected: "image"
                },
                {
                    name: "URL null",
                    url: null,
                    expected: "image"
                }
            ];

            const container = document.getElementById('automaticTests');
            container.innerHTML = '';

            const detector = new MediaDetectorInteligente();

            for (const test of tests) {
                try {
                    const result = await detector.detectarTipoMedia(test.url);
                    const isSuccess = result.tipo === test.expected;
                    
                    const testElement = document.createElement('div');
                    testElement.className = `test-result ${isSuccess ? 'test-success' : 'test-error'}`;
                    
                    testElement.innerHTML = `
                        <h6>${isSuccess ? '‚úÖ' : '‚ùå'} ${test.name}</h6>
                        <p><strong>URL:</strong> ${test.url || 'null'}</p>
                        <p><strong>Esperado:</strong> ${test.expected}</p>
                        <p><strong>Resultado:</strong> ${result.tipo}</p>
                        <p><strong>Confianza:</strong> ${result.confianza}%</p>
                        <small><strong>Raz√≥n:</strong> ${result.razon}</small>
                    `;
                    
                    container.appendChild(testElement);
                } catch (error) {
                    const testElement = document.createElement('div');
                    testElement.className = 'test-result test-error';
                    testElement.innerHTML = `
                        <h6>‚ùå ${test.name}</h6>
                        <p><strong>Error:</strong> ${error.message}</p>
                    `;
                    container.appendChild(testElement);
                }
            }
        }

        // Test manual
        async function testManualUrl() {
            const url = document.getElementById('mediaUrl').value;
            const resultContainer = document.getElementById('manualTestResult');
            
            if (!url.trim()) {
                resultContainer.innerHTML = '<div class="alert alert-warning">Por favor ingresa una URL</div>';
                return;
            }

            try {
                const detector = new MediaDetectorInteligente();
                const result = await detector.detectarTipoMedia(url);
                
                // Generar HTML usando la funci√≥n inteligente
                const mediaHTML = generarMediaHTMLSincrono(url, "Test Media", "media-test", "max-width: 300px; max-height: 200px;");
                
                resultContainer.innerHTML = `
                    <div class="test-result test-success">
                        <h5>üìä Resultado del An√°lisis</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>üîó URL:</strong> ${url}</p>
                                <p><strong>üìù Tipo detectado:</strong> ${result.tipo}</p>
                                <p><strong>üéØ Confianza:</strong> ${result.confianza}%</p>
                                <p><strong>üß† M√©todo:</strong> ${result.metodo}</p>
                                <p><strong>üí° Raz√≥n:</strong> ${result.razon}</p>
                                <p><strong>‚ö†Ô∏è Fallback:</strong> ${result.fallback ? 'S√≠' : 'No'}</p>
                            </div>
                            <div class="col-md-6">
                                <h6>üñºÔ∏è Vista previa:</h6>
                                <div class="border rounded p-2">
                                    ${mediaHTML}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                resultContainer.innerHTML = `
                    <div class="test-result test-error">
                        <h5>‚ùå Error</h5>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Ejecutar tests autom√°ticos al cargar
        document.addEventListener('DOMContentLoaded', runAutomaticTests);

        // Permitir test con Enter
        document.getElementById('mediaUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                testManualUrl();
            }
        });
    </script>
</body>
</html>