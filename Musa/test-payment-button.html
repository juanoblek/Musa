<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test BotÃ³n Pago</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>ğŸ§ª Test BotÃ³n de Pago</h1>
        
        <div class="alert alert-info">
            <h5>ğŸ“‹ Instrucciones:</h5>
            <ol>
                <li>Primero agrega algunos productos de prueba al carrito</li>
                <li>Luego haz click en "Pagar Ahora" para probar</li>
            </ol>
        </div>
        
        <div class="card mb-4">
            <div class="card-body">
                <h5>ğŸ›’ Agregar productos de prueba</h5>
                <button class="btn btn-success" onclick="addTestProducts()">Agregar Productos Test</button>
                <button class="btn btn-warning" onclick="showCart()">Ver Carrito</button>
                <button class="btn btn-danger" onclick="clearCart()">Limpiar Carrito</button>
            </div>
        </div>
        
        <div class="card">
            <div class="card-body">
                <h5>ğŸ’³ Test BotÃ³n de Pago</h5>
                <p>Estado de la funciÃ³n: <span id="functionStatus">Verificando...</span></p>
                <button class="btn btn-primary btn-lg" onclick="window.proceedToPayment()">
                    <i class="bi bi-credit-card me-2"></i>Pagar Ahora (Test)
                </button>
            </div>
        </div>
        
        <div class="mt-4">
            <h5>ğŸ“Š Console Logs:</h5>
            <div id="console-output" class="bg-dark text-light p-3 rounded" style="height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px;"></div>
        </div>
    </div>

    <script>
        // FunciÃ³n para agregar productos de prueba
        function addTestProducts() {
            const testProducts = [
                { id: 1, name: 'Producto Test 1', price: 50000, size: 'M', color: 'Azul', quantity: 1 },
                { id: 2, name: 'Producto Test 2', price: 75000, size: 'L', color: 'Rojo', quantity: 2 }
            ];
            
            localStorage.setItem('cart', JSON.stringify(testProducts));
            log('âœ… Productos de prueba agregados al carrito');
            showCart();
        }
        
        // FunciÃ³n para mostrar carrito
        function showCart() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            log('ğŸ›’ Carrito actual: ' + JSON.stringify(cart, null, 2));
        }
        
        // FunciÃ³n para limpiar carrito
        function clearCart() {
            localStorage.removeItem('cart');
            log('ğŸ—‘ï¸ Carrito limpiado');
        }
        
        // FunciÃ³n de log personalizada
        function log(message) {
            const output = document.getElementById('console-output');
            const time = new Date().toLocaleTimeString();
            output.innerHTML += `[${time}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }
        
        // FunciÃ³n de pago de prueba
        window.proceedToPayment = function() {
            log('ğŸ’³ [TEST] Iniciando proceso de pago...');
            
            try {
                const cart = JSON.parse(localStorage.getItem('cart') || '[]');
                
                if (cart.length === 0) {
                    log('âš ï¸ [TEST] El carrito estÃ¡ vacÃ­o');
                    alert('âš ï¸ El carrito estÃ¡ vacÃ­o. Agrega productos antes de continuar.');
                    return;
                }
                
                // Calcular total
                const total = cart.reduce((sum, item) => {
                    const price = parseFloat(item.price) || 0;
                    const quantity = parseInt(item.quantity) || 1;
                    return sum + (price * quantity);
                }, 0);
                
                log('ğŸ›’ [TEST] Carrito para checkout:');
                log('  - Items: ' + cart.length);
                log('  - Total: $' + total.toLocaleString());
                log('  - Productos: ' + JSON.stringify(cart, null, 2));
                
                alert(`âœ… Â¡FunciÃ³n de pago funciona!\n\nItems: ${cart.length}\nTotal: $${total.toLocaleString()}`);
                
            } catch (error) {
                log('âŒ [TEST] Error en proceedToPayment: ' + error.message);
                alert('âŒ Error al procesar el pago: ' + error.message);
            }
        };
        
        // Verificar estado de la funciÃ³n
        document.addEventListener('DOMContentLoaded', () => {
            const statusElement = document.getElementById('functionStatus');
            
            if (typeof window.proceedToPayment === 'function') {
                statusElement.innerHTML = '<span class="text-success">âœ… FunciÃ³n disponible</span>';
                log('âœ… FunciÃ³n proceedToPayment estÃ¡ disponible');
            } else {
                statusElement.innerHTML = '<span class="text-danger">âŒ FunciÃ³n no disponible</span>';
                log('âŒ FunciÃ³n proceedToPayment NO estÃ¡ disponible');
            }
            
            log('ğŸš€ Test de botÃ³n de pago iniciado');
        });
    </script>
</body>
</html>
