<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Debug Pago Premium</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .debug-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { border-color: #28a745; background: #f8fff9; }
        .error { border-color: #dc3545; background: #fff8f8; }
        .warning { border-color: #ffc107; background: #fffef8; }
        .console-output { background: #2d3748; color: #fff; padding: 15px; border-radius: 5px; font-family: monospace; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">üîç Debug Sistema de Pago Premium</h1>
        
        <div class="debug-section">
            <h3>üì¶ Estado del Carrito</h3>
            <div id="cartStatus"></div>
        </div>
        
        <div class="debug-section">
            <h3>üéØ Pesta√±as de M√©todos de Pago</h3>
            <div id="paymentTabs"></div>
        </div>
        
        <div class="debug-section">
            <h3>üì± Elementos del DOM</h3>
            <div id="domElements"></div>
        </div>
        
        <div class="debug-section">
            <h3>üöÄ Sistema de Pago</h3>
            <div id="paymentSystem"></div>
        </div>
        
        <div class="debug-section">
            <h3>üìÑ Console Output</h3>
            <div id="consoleOutput" class="console-output"></div>
        </div>
        
        <div class="text-center mt-4">
            <button class="btn btn-primary" onclick="runFullDebug()">üîÑ Ejecutar Debug Completo</button>
            <button class="btn btn-success" onclick="addTestProducts()">üì¶ Agregar Productos de Prueba</button>
            <a href="pago-premium.html" class="btn btn-secondary">üîô Volver a Pago Premium</a>
        </div>
    </div>

    <script>
        // Capturar logs de consola
        let consoleLogs = [];
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            consoleLogs.push({type: 'log', message: args.join(' '), time: new Date().toLocaleTimeString()});
            updateConsoleOutput();
            originalLog.apply(console, arguments);
        };
        
        console.error = function(...args) {
            consoleLogs.push({type: 'error', message: args.join(' '), time: new Date().toLocaleTimeString()});
            updateConsoleOutput();
            originalError.apply(console, arguments);
        };
        
        console.warn = function(...args) {
            consoleLogs.push({type: 'warn', message: args.join(' '), time: new Date().toLocaleTimeString()});
            updateConsoleOutput();
            originalWarn.apply(console, arguments);
        };
        
        function updateConsoleOutput() {
            const output = document.getElementById('consoleOutput');
            output.innerHTML = consoleLogs.slice(-20).map(log => 
                `<div style="color: ${log.type === 'error' ? '#ff6b6b' : log.type === 'warn' ? '#ffa500' : '#fff'}">
                    [${log.time}] ${log.message}
                </div>`
            ).join('');
            output.scrollTop = output.scrollHeight;
        }
        
        function runFullDebug() {
            console.log('üîç Iniciando debug completo...');
            
            // 1. Verificar carrito
            checkCart();
            
            // 2. Verificar elementos DOM
            checkDOMElements();
            
            // 3. Verificar pesta√±as de pago
            checkPaymentTabs();
            
            // 4. Verificar sistema de pago
            checkPaymentSystem();
            
            console.log('‚úÖ Debug completo finalizado');
        }
        
        function checkCart() {
            const cartData = localStorage.getItem('carrito');
            const cartStatus = document.getElementById('cartStatus');
            
            if (cartData) {
                try {
                    const cart = JSON.parse(cartData);
                    if (Array.isArray(cart) && cart.length > 0) {
                        cartStatus.className = 'alert alert-success';
                        cartStatus.innerHTML = `
                            <h5>‚úÖ Carrito Encontrado</h5>
                            <p><strong>Productos:</strong> ${cart.length}</p>
                            <div style="max-height: 150px; overflow-y: auto;">
                                ${cart.map((item, index) => `
                                    <div class="border-bottom py-2">
                                        <strong>${index + 1}.</strong> ${item.name || item.nombre || 'Sin nombre'} - 
                                        $${(item.price || item.precio || 0).toLocaleString()} x 
                                        ${item.quantity || item.cantidad || 1}
                                    </div>
                                `).join('')}
                            </div>
                        `;
                        console.log('‚úÖ Carrito v√°lido encontrado:', cart.length, 'productos');
                    } else {
                        cartStatus.className = 'alert alert-warning';
                        cartStatus.innerHTML = '<h5>‚ö†Ô∏è Carrito Vac√≠o</h5><p>El carrito existe pero no tiene productos.</p>';
                        console.warn('‚ö†Ô∏è Carrito vac√≠o');
                    }
                } catch (error) {
                    cartStatus.className = 'alert alert-danger';
                    cartStatus.innerHTML = `<h5>‚ùå Error en Carrito</h5><p>Error parseando datos: ${error.message}</p>`;
                    console.error('‚ùå Error parseando carrito:', error);
                }
            } else {
                cartStatus.className = 'alert alert-danger';
                cartStatus.innerHTML = '<h5>‚ùå Sin Carrito</h5><p>No se encontr√≥ carrito en localStorage.</p>';
                console.error('‚ùå No hay carrito en localStorage');
            }
        }
        
        function checkDOMElements() {
            const elements = [
                {name: 'Formulario de Tarjeta', id: 'cardForm'},
                {name: 'Formulario PSE', id: 'pseForm'},
                {name: 'Bot√≥n de Pago', id: 'payButton'},
                {name: 'Campo N√∫mero de Tarjeta', id: 'cardNumber'},
                {name: 'Secci√≥n de Env√≠o', selector: '.shipping-section'},
                {name: 'Pesta√±as de M√©todo', selector: '.method-tab'}
            ];
            
            const domElements = document.getElementById('domElements');
            let html = '<div class="row">';
            
            elements.forEach(element => {
                const el = element.id ? document.getElementById(element.id) : 
                           element.selector ? document.querySelector(element.selector) : null;
                const found = !!el;
                const count = element.selector ? document.querySelectorAll(element.selector).length : (found ? 1 : 0);
                
                html += `
                    <div class="col-md-6 mb-2">
                        <div class="badge ${found ? 'bg-success' : 'bg-danger'} w-100 text-start p-2">
                            ${found ? '‚úÖ' : '‚ùå'} ${element.name}
                            ${element.selector && count > 1 ? ` (${count})` : ''}
                        </div>
                    </div>
                `;
                
                console.log(`${found ? '‚úÖ' : '‚ùå'} ${element.name}:`, found ? 'Encontrado' : 'No encontrado');
            });
            
            html += '</div>';
            domElements.innerHTML = html;
        }
        
        function checkPaymentTabs() {
            const tabs = document.querySelectorAll('.method-tab');
            const paymentTabs = document.getElementById('paymentTabs');
            
            if (tabs.length > 0) {
                paymentTabs.className = 'alert alert-success';
                paymentTabs.innerHTML = `
                    <h5>‚úÖ Pesta√±as de Pago Encontradas (${tabs.length})</h5>
                    <div class="row">
                        ${Array.from(tabs).map((tab, index) => {
                            const method = tab.dataset.method;
                            const isActive = tab.classList.contains('active');
                            return `
                                <div class="col-md-3 mb-2">
                                    <div class="card ${isActive ? 'border-primary' : ''}">
                                        <div class="card-body text-center p-2">
                                            <div class="badge ${isActive ? 'bg-primary' : 'bg-secondary'} mb-1">${method}</div>
                                            <br>
                                            <small>${isActive ? 'ACTIVO' : 'Inactivo'}</small>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                console.log('‚úÖ Pesta√±as de pago encontradas:', tabs.length);
            } else {
                paymentTabs.className = 'alert alert-danger';
                paymentTabs.innerHTML = '<h5>‚ùå No se encontraron pesta√±as de pago</h5>';
                console.error('‚ùå No se encontraron pesta√±as de pago');
            }
        }
        
        function checkPaymentSystem() {
            const paymentSystem = document.getElementById('paymentSystem');
            
            if (window.paymentSystem) {
                paymentSystem.className = 'alert alert-success';
                paymentSystem.innerHTML = `
                    <h5>‚úÖ Sistema de Pago Encontrado</h5>
                    <p><strong>Tipo:</strong> ${typeof window.paymentSystem}</p>
                    <p><strong>Carrito:</strong> ${window.paymentSystem.cart ? window.paymentSystem.cart.length : 'No definido'} productos</p>
                    <p><strong>Total:</strong> $${window.paymentSystem.total ? window.paymentSystem.total.toLocaleString() : 'No calculado'}</p>
                    <div class="mt-2">
                        <button class="btn btn-sm btn-primary" onclick="window.paymentSystem.debugSystem()">Debug Sistema</button>
                        <button class="btn btn-sm btn-success" onclick="window.paymentSystem.addTestProducts()">Agregar Productos</button>
                    </div>
                `;
                console.log('‚úÖ Sistema de pago disponible');
            } else {
                paymentSystem.className = 'alert alert-danger';
                paymentSystem.innerHTML = '<h5>‚ùå Sistema de Pago No Encontrado</h5><p>window.paymentSystem no est√° definido.</p>';
                console.error('‚ùå Sistema de pago no disponible');
            }
        }
        
        function addTestProducts() {
            console.log('üîÑ Agregando productos de prueba...');
            
            const testProducts = [
                {
                    id: 1,
                    name: "Camisa Elegante Azul",
                    precio: 89900,
                    cantidad: 1,
                    color: "Azul",
                    talla: "M",
                    imagen: "images/test-product.jpg"
                },
                {
                    id: 2,
                    name: "Pantal√≥n Formal Negro",
                    precio: 129900,
                    cantidad: 1,
                    color: "Negro",
                    talla: "32",
                    imagen: "images/test-product2.jpg"
                }
            ];
            
            localStorage.setItem('carrito', JSON.stringify(testProducts));
            console.log('‚úÖ Productos de prueba agregados al carrito');
            
            // Actualizar debug
            setTimeout(() => {
                checkCart();
            }, 100);
        }
        
        // Ejecutar debug inicial
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Debug p√°gina cargada');
            setTimeout(runFullDebug, 500);
        });
    </script>
</body>
</html>