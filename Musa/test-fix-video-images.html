<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Fix Video Images</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        .test-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .before-after {
            display: flex;
            gap: 20px;
        }
        .before, .after {
            flex: 1;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 4px;
        }
        .before {
            background-color: #ffe6e6;
        }
        .after {
            background-color: #e6ffe6;
        }
    </style>
</head>
<body>
    <div class="container test-container">
        <h1 class="text-center mb-4">üîß Test Fix Video Images</h1>
        
        <div class="alert alert-info">
            <h6>üß™ Este test simula el problema:</h6>
            <p>1. Crear im√°genes que apunten a archivos de video (.mp4)</p>
            <p>2. El fix deber√≠a convertirlas autom√°ticamente a elementos &lt;video&gt;</p>
        </div>
        
        <div class="test-card">
            <h4>Test 1: Imagen con video .mp4</h4>
            <div class="before-after">
                <div class="before">
                    <h6>‚ùå ANTES (problema):</h6>
                    <img src="uploads/video_68f0254985a91_1760568649.mp4" 
                         class="card-img-top product-image glasseffect" 
                         alt="Chaqueta See" 
                         style="max-width: 200px; max-height: 150px; object-fit: cover;">
                </div>
                <div class="after">
                    <h6>‚úÖ DESPU√âS (esperado):</h6>
                    <div id="converted1">Conversi√≥n autom√°tica aqu√≠...</div>
                </div>
            </div>
        </div>
        
        <div class="test-card">
            <h4>Test 2: Imagen con video .mov</h4>
            <div class="before-after">
                <div class="before">
                    <h6>‚ùå ANTES:</h6>
                    <img src="uploads/test_video.mov" 
                         class="card-img-top product-image" 
                         alt="Test Video MOV" 
                         style="max-width: 200px; max-height: 150px;">
                </div>
                <div class="after">
                    <h6>‚úÖ DESPU√âS:</h6>
                    <div id="converted2">Conversi√≥n autom√°tica aqu√≠...</div>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <h4>üîÑ Acciones de Test</h4>
            <button class="btn btn-primary me-2" onclick="addDynamicVideoImage()">‚ûï Agregar Imagen de Video Din√°micamente</button>
            <button class="btn btn-success me-2" onclick="checkConversions()">üîç Verificar Conversiones</button>
            <button class="btn btn-warning me-2" onclick="showResults()">üìä Mostrar Resultados</button>
        </div>
        
        <div id="dynamicTest" class="mt-4"></div>
        <div id="results" class="mt-4"></div>
    </div>

    <!-- Cargar scripts en orden -->
    <script src="js/detector-inteligente-media.js"></script>
    <script src="js/fix-video-images.js"></script>
    
    <script>
        let testCounter = 0;
        
        function addDynamicVideoImage() {
            testCounter++;
            const container = document.getElementById('dynamicTest');
            
            const testDiv = document.createElement('div');
            testDiv.className = 'test-card';
            testDiv.innerHTML = `
                <h5>Test Din√°mico ${testCounter}</h5>
                <p>Imagen agregada din√°micamente - deber√≠a convertirse autom√°ticamente:</p>
                <img src="uploads/dynamic_test_${testCounter}.mp4" 
                     class="card-img-top product-image glasseffect" 
                     alt="Test Din√°mico ${testCounter}" 
                     style="max-width: 200px; max-height: 150px; object-fit: cover; border: 2px solid red;">
            `;
            
            container.appendChild(testDiv);
            console.log(`‚ûï Agregada imagen din√°mica ${testCounter}`);
        }
        
        function checkConversions() {
            const videoImages = document.querySelectorAll('img[src*=".mp4"], img[src*=".mov"], img[src*=".avi"], img[src*=".webm"]');
            const videos = document.querySelectorAll('video[src*=".mp4"], video[src*=".mov"], video[src*=".avi"], video[src*=".webm"]');
            
            console.log(`üîç Im√°genes de video restantes: ${videoImages.length}`);
            console.log(`üé¨ Videos convertidos: ${videos.length}`);
            
            document.getElementById('results').innerHTML = `
                <div class="alert alert-info">
                    <h6>üìä Estado de Conversiones:</h6>
                    <p>üñºÔ∏è Im√°genes de video restantes: <strong>${videoImages.length}</strong></p>
                    <p>üé¨ Videos convertidos: <strong>${videos.length}</strong></p>
                    <p>‚úÖ Fix funcionando: <strong>${videoImages.length === 0 ? 'S√ç' : 'NO'}</strong></p>
                </div>
            `;
        }
        
        function showResults() {
            const allImages = document.querySelectorAll('img');
            const allVideos = document.querySelectorAll('video');
            
            let resultsHTML = '<div class="alert alert-success"><h6>üìà Resultados Completos:</h6>';
            resultsHTML += `<p>Total de im√°genes: ${allImages.length}</p>`;
            resultsHTML += `<p>Total de videos: ${allVideos.length}</p>`;
            resultsHTML += '<h6>üñºÔ∏è Im√°genes encontradas:</h6><ul>';
            
            allImages.forEach((img, index) => {
                resultsHTML += `<li>Imagen ${index + 1}: ${img.src} (${img.className})</li>`;
            });
            
            resultsHTML += '</ul><h6>üé¨ Videos encontrados:</h6><ul>';
            
            allVideos.forEach((video, index) => {
                resultsHTML += `<li>Video ${index + 1}: ${video.src} (${video.className})</li>`;
            });
            
            resultsHTML += '</ul></div>';
            
            document.getElementById('results').innerHTML = resultsHTML;
        }
        
        // Auto-verificar despu√©s de cargar
        setTimeout(() => {
            console.log('üîç Verificaci√≥n autom√°tica despu√©s de 3 segundos...');
            checkConversions();
        }, 3000);
    </script>
</body>
</html>