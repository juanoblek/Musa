<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Modal Videos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        .test-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
        }
        .modal-test-button {
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="container test-container">
        <h1 class="text-center mb-4">üé¨ Test Modal Videos</h1>
        
        <div class="alert alert-info">
            <h6>üß™ Test del Modal ProductViewModal:</h6>
            <p>Este test simula abrir el modal con diferentes tipos de media para verificar que los videos se muestren correctamente.</p>
        </div>
        
        <div class="test-card">
            <h4>üìã Tests Disponibles</h4>
            <button class="btn btn-primary modal-test-button" onclick="testModalWithVideo()">üé¨ Test Modal con Video MP4</button>
            <button class="btn btn-success modal-test-button" onclick="testModalWithImage()">üñºÔ∏è Test Modal con Imagen</button>
            <button class="btn btn-warning modal-test-button" onclick="testModalWithVideoMOV()">üé• Test Modal con Video MOV</button>
            <button class="btn btn-info modal-test-button" onclick="testDirectVideoAdd()">‚ö° Test Agregar Video Directo</button>
        </div>
        
        <div class="test-card">
            <h4>üîç Estado del Sistema</h4>
            <div id="systemStatus"></div>
            <button class="btn btn-secondary" onclick="checkSystemStatus()">üîÑ Verificar Estado</button>
        </div>
        
        <div class="test-card">
            <h4>üìä Resultados de Tests</h4>
            <div id="testResults"></div>
        </div>
    </div>

    <!-- Modal de prueba (copia del ProductViewModal) -->
    <div class="modal fade" id="ProductViewModal" tabindex="-1" aria-labelledby="ProductViewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header border-0 position-relative" style="padding: 15px; min-height: 60px; background: transparent;">
                    <h5 class="modal-title" id="productViewTitle">Test Modal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="row g-0">
                        <div class="col-lg-8">
                            <div class="product-view-image-container">
                                <div id="productViewCarousel" class="carousel slide h-100" data-bs-ride="carousel">
                                    <div class="carousel-inner h-100" id="productViewCarouselInner">
                                        <div class="carousel-item active">
                                            <div class="d-flex align-items-center justify-content-center h-100" style="min-height: 400px;">
                                                <p class="text-muted">Contenido se cargar√° aqu√≠...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="p-4">
                                <h3 id="productViewTitle">Producto de Prueba</h3>
                                <p>Este es un modal de prueba para verificar la funcionalidad de videos.</p>
                                <button class="btn btn-primary">Test Button</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts necesarios -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/detector-inteligente-media.js"></script>
    <script src="js/fix-modal-videos.js"></script>
    
    <script>
        // Funciones de test
        function testModalWithVideo() {
            console.log('üé¨ Iniciando test con video MP4...');
            
            const testData = {
                image: 'uploads/video_68f0254985a91_1760568649.mp4',
                title: 'Chaqueta See (Video Test)',
                price: '$150.000'
            };
            
            populateTestModal(testData);
            showModal();
            
            logTestResult('Video MP4', testData.image);
        }
        
        function testModalWithImage() {
            console.log('üñºÔ∏è Iniciando test con imagen...');
            
            const testData = {
                image: 'images/placeholder.jpg',
                title: 'Producto con Imagen',
                price: '$100.000'
            };
            
            populateTestModal(testData);
            showModal();
            
            logTestResult('Imagen JPG', testData.image);
        }
        
        function testModalWithVideoMOV() {
            console.log('üé• Iniciando test con video MOV...');
            
            const testData = {
                image: 'uploads/test_video.mov',
                title: 'Video MOV Test',
                price: '$200.000'
            };
            
            populateTestModal(testData);
            showModal();
            
            logTestResult('Video MOV', testData.image);
        }
        
        function testDirectVideoAdd() {
            console.log('‚ö° Test de funci√≥n directa addVideoToModal...');
            
            if (typeof window.addVideoToModal === 'function') {
                const result = window.addVideoToModal('uploads/direct_test.mp4', 'Video Directo');
                showModal();
                
                logTestResult('Video Directo', 'uploads/direct_test.mp4', result ? '√âxito' : 'Fall√≥');
            } else {
                logTestResult('Video Directo', 'N/A', 'Funci√≥n no disponible');
            }
        }
        
        function populateTestModal(data) {
            // Simular funci√≥n populateProductModal
            const carouselInner = document.getElementById('productViewCarouselInner');
            const titleElement = document.getElementById('productViewTitle');
            
            if (titleElement) {
                titleElement.textContent = data.title;
            }
            
            if (carouselInner && typeof generarMediaHTMLSincrono !== 'undefined') {
                const mediaHTML = generarMediaHTMLSincrono(
                    data.image, 
                    data.title, 
                    "d-block w-100", 
                    "max-height: 400px; object-fit: contain; background: #f8f9fa;"
                );
                
                carouselInner.innerHTML = `
                    <div class="carousel-item active">
                        ${mediaHTML}
                    </div>
                `;
                
                console.log('‚úÖ Modal poblado con detector inteligente');
            } else {
                console.error('‚ùå Detector inteligente no disponible');
                // Fallback b√°sico
                carouselInner.innerHTML = `
                    <div class="carousel-item active">
                        <img src="${data.image}" class="d-block w-100" alt="${data.title}" style="max-height: 400px; object-fit: contain;">
                    </div>
                `;
            }
        }
        
        function showModal() {
            const modal = new bootstrap.Modal(document.getElementById('ProductViewModal'));
            modal.show();
        }
        
        function checkSystemStatus() {
            const status = {
                'Detector Inteligente': typeof generarMediaHTMLSincrono !== 'undefined' ? '‚úÖ Disponible' : '‚ùå No disponible',
                'Fix Modal Videos': typeof window.addVideoToModal !== 'undefined' ? '‚úÖ Cargado' : '‚ùå No cargado',
                'Bootstrap Modal': typeof bootstrap !== 'undefined' ? '‚úÖ Disponible' : '‚ùå No disponible',
                'Modal Element': document.getElementById('ProductViewModal') ? '‚úÖ Encontrado' : '‚ùå No encontrado',
                'Carousel Element': document.getElementById('productViewCarouselInner') ? '‚úÖ Encontrado' : '‚ùå No encontrado'
            };
            
            let html = '<div class="alert alert-info"><h6>üìä Estado del Sistema:</h6>';
            for (const [key, value] of Object.entries(status)) {
                html += `<p><strong>${key}:</strong> ${value}</p>`;
            }
            html += '</div>';
            
            document.getElementById('systemStatus').innerHTML = html;
        }
        
        function logTestResult(testType, url, status = 'Ejecutado') {
            const timestamp = new Date().toLocaleTimeString();
            const resultDiv = document.getElementById('testResults');
            
            const resultHTML = `
                <div class="alert alert-secondary">
                    <strong>${timestamp}</strong> - <strong>${testType}:</strong> ${url} 
                    <span class="badge ${status === '√âxito' ? 'bg-success' : status === 'Fall√≥' ? 'bg-danger' : 'bg-info'}">${status}</span>
                </div>
            `;
            
            resultDiv.innerHTML += resultHTML;
        }
        
        // Auto-verificar estado al cargar
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(checkSystemStatus, 1000);
        });
    </script>
</body>
</html>